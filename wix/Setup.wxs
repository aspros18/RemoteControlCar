<?xml version='1.0' encoding='utf-8'?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">

  <!-- Magyar nyelvű a telepítő. Az összes GUID a Visual Studio segítségével lett generálva. -->
  <Product Name='Mobile-RC' Id='6ED552EB-F733-47B5-8CA8-4832EEFDB6C3' UpgradeCode='B66E730E-D8D1-4765-AAB5-C58AB523E5D9'
    Language='1038' Codepage='1250' Version='1.0.0' Manufacturer='Farkas Zoltán'>

    <Package Id='*' Keywords='Installer' Description="Mobile-RC Installer" Manufacturer='Farkas Zoltán'
      InstallerVersion='100' Languages='1038' Compressed='yes' SummaryCodepage='1250' Comments='BSc diplomamunka.' />

    <!-- A telepítő ebből a cabinet fájlból bontja ki a telepítés helyére a benne lévő fájlokat és a cabinet fájlt a telepítő tartalmazza. -->
    <Media Id='1' Cabinet='media.cab' EmbedCab='yes' />

    <Directory Id='TARGETDIR' Name='SourceDir'>

        <!-- A Program fájlok könyvtárba települ az alkalmazás. -->
        <Directory Id='ProgramFilesFolder'>
            <!-- Ezen belül is a Mobile-RC könyvtárba. -->
            <Directory Id='INSTALLDIR' Name='Mobile-RC'>

                <!-- Az alkalmazásindító fájlok definiálása. -->
                <Component Id='MainExecutable' Guid='B858FCD8-A0B2-48FB-BA41-CE2773C7635C'>

                    <File Id='ClientEXE' Source='client.exe' KeyPath='yes'>

                        <!-- A kliens alkalmazást indító fájl elérhető az asztalról és a Start menüből is. -->
                        <Shortcut Id='startmenuClient' Directory="ProgramMenuDir" Name="Mobile-RC kliens" Icon="client.exe" IconIndex="0" WorkingDirectory='INSTALLDIR' Advertise='yes' />
                        <Shortcut Id='desktopClient' Directory="DesktopFolder" Name="Mobile-RC" Icon="client.exe" IconIndex="0" WorkingDirectory='INSTALLDIR' Advertise='yes' />

                    </File>

                    <!-- Az alkalmazás az alábbi fájlokat hozhatja létre, amik telepítéskor még nem léteztek, de eltávolításkor törölni kell őket is. -->
                    <RemoveFile Id='LogFile' On='uninstall' Name='bridge.log' />
                    <RemoveFile Id='BridgeConfFile' On='uninstall' Name='bridge.conf' />
                    <RemoveFile Id='ControllerConfFile' On='uninstall' Name='controller.ser' />
                    <RemoveFile Id='WhitelistFile' On='uninstall' Name='whitelist.conf' />
                    <RemoveFile Id='BlacklistFile' On='uninstall' Name='blacklist.conf' />
                    <RemoveFile Id='BlocklistFile' On='uninstall' Name='blocklist.conf' />
                    <RemoveFile Id='NoSwtFile' On='uninstall' Name='.noswt' />

                </Component>

                <!-- Maga a futtatható Java alkalmazást tartalmazó jar fájl. -->
                <Component Id='JavaApplication' Guid='5AC6C54A-4D61-4FD6-9E22-3DCD98D73EA0'>
                    <File Id='UiJar' Name='ui.jar' Source='ui.jar' KeyPath='yes'/>
                    <CreateFolder Directory="INSTALLDIR">
                        <util:PermissionEx User="Users" GenericAll="yes" />
                    </CreateFolder>
                </Component>

                <!-- A diplomamunka PDF formátumban. -->
                <Component Id='Manual' Guid='3C67AC75-39CA-4DE9-BDE5-BA52FF59720F'>
                    <File Id='Manual' Name='manual.pdf' Source='manual.pdf' KeyPath='yes'>
                        <!-- A Start menüből érhető el. -->
                        <Shortcut Id='startmenuManual' Directory='ProgramMenuDir' Name='Dokumentáció' Advertise='yes' />
                    </File>
                </Component>

            </Directory>
        </Directory>

        <!-- Az alkalmazás helye a Start menüben. -->
        <Directory Id="ProgramMenuFolder" Name="Programs">
            <Directory Id="ProgramMenuDir" Name="Mobile-RC">
                <Component Id="ProgramMenuDir" Guid="6057411C-E132-4CD9-9A08-ADE5D7C1377F">
                    <!-- Eltávolításkor törlődik a könyvtár a Start menüből. -->
                    <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
                    <!-- Registry bejegyzés a könyvtárhoz. -->
                    <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
                    <!-- Alkalmazás-eltávolító parancsikon kerül a könyvtárba. -->
                    <Shortcut Id="UninstallProduct" Directory="ProgramMenuDir" Name="Mobile-RC eltávolítása" Target="[SystemFolder]msiexec.exe" Arguments="/x [ProductCode]" Description="Az alkalmazás eltávolítása." />
                </Component>
            </Directory>
        </Directory>

        <!-- Hivatkozás az asztalra, ami a fenti definícióban használva is van. -->
        <Directory Id="DesktopFolder" Name="Desktop" />

    </Directory>

    <!-- A gyökér eleme, ami minden más elemet tartalmaz. Ezt kiválasztva minden települ. -->
    <Feature Id='Complete' Absent='disallow' Title='Mobile-RC' Description='A teljes csomag.'
      Display='expand' Level='1' ConfigurableDirectory='INSTALLDIR'>

        <!-- Alapértelmezés szerint csak az alkalmazás és a parancsikonok vannak telepítésre jelölve. -->
        <Feature Id='MainProgram' Absent='disallow' Title='Program' Description='Az alkalmazás és hivatkozásai.' Level='1'>
            <ComponentRef Id='JavaApplication' />
            <ComponentRef Id='MainExecutable' />
            <ComponentRef Id='ProgramMenuDir' />
        </Feature>

        <!-- A dokumentáció alapértelmezés szerint nincs telepítésre jelölve, mivel a level elég magas. -->
        <Feature Id='Documentation' Title='Dokumentáció' Description='A diplomamunka PDF formátumban.' Level='1000'>
            <ComponentRef Id='Manual' />
        </Feature>

    </Feature>

    <!-- A kliens ikon az exe fájlból van kiolvasva. -->
    <Icon Id="client.exe" SourceFile="client.exe" />

    <UI>
        <!-- Olyan felületet ad, mely a lehető legtöbb beállítást tartalmazza. -->
        <UIRef Id="WixUI_MondoNoLicense" />
        <UIRef Id="WixUI_ErrorProgressText" />
    </UI>

    <!-- A telepítés könyvtárának módosulásakor megváltozik a konfigban beállított alapértelmezés. -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

    <!-- A vezérlőpultból elérhető program-eltávolító ablak listájában látható ikon. -->
    <Property Id="ARPPRODUCTICON" Value="client.exe" />

  </Product>

  <!-- Egy olyan grafikus felületet leíró teg, mely megegyezik az eredeti WixUI_Mondo teggel, de ebből ki van hagyva a licensz elfogadó ablak. -->
  <Fragment>
    <UI Id="WixUI_MondoNoLicense">
      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <Property Id="WixUI_Mode" Value="Mondo" />

      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="MsiRMFilesInUse" />
      <DialogRef Id="PrepareDlg" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="ResumeDlg" />
      <DialogRef Id="UserExit" />

      <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="SetupTypeDlg">1</Publish>

      <Publish Dialog="SetupTypeDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">1</Publish>
      <Publish Dialog="SetupTypeDlg" Control="TypicalButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="SetupTypeDlg" Control="CustomButton" Event="NewDialog" Value="CustomizeDlg">1</Publish>
      <Publish Dialog="SetupTypeDlg" Control="CompleteButton" Event="NewDialog"
               Value="VerifyReadyDlg">1</Publish>

      <Publish Dialog="CustomizeDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg"
               Order="1">WixUI_InstallMode = "Change"</Publish>
      <Publish Dialog="CustomizeDlg" Control="Back" Event="NewDialog" Value="SetupTypeDlg"
               Order="2">WixUI_InstallMode = "InstallCustom"</Publish>
      <Publish Dialog="CustomizeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>

      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="CustomizeDlg"
               Order="1">WixUI_InstallMode = "InstallCustom"</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="SetupTypeDlg"
               Order="2">WixUI_InstallMode = "InstallTypical" OR WixUI_InstallMode = "InstallComplete"</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="CustomizeDlg"
               Order="3">WixUI_InstallMode = "Change"</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg"
               Order="4">WixUI_InstallMode = "Repair" OR WixUI_InstallMode = "Remove"</Publish>

      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog"
               Value="MaintenanceTypeDlg">1</Publish>

      <Publish Dialog="MaintenanceTypeDlg" Control="ChangeButton" Event="NewDialog"
               Value="CustomizeDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog"
               Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog"
               Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog"
               Value="MaintenanceWelcomeDlg">1</Publish>
    </UI>

    <UIRef Id="WixUI_Common" />
  </Fragment>

</Wix>